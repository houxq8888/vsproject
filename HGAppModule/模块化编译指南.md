# HGAppModule 模块化编译指南

## 概述

模块化编译功能允许您选择性地编译特定的模块，而不是每次都编译整个项目。这可以显著减少编译时间，特别是在开发特定功能时。

## 快速开始

### 使用批处理脚本（推荐）

```cmd
# 编译搜索模块和曲线模块
modular_build.bat HGSearchModule HGCurveModule

# 编译所有模块并清理构建目录
modular_build.bat all --clean

# 编译特定模块并使用8个并行任务
modular_build.bat HGPrintModule HGUartModule --jobs 8

# 使用Debug模式编译
modular_build.bat HGSearchModule --debug

# 查看帮助信息
modular_build.bat --help
```

### 使用PowerShell脚本（功能更强大）

```powershell
# 编译搜索模块和曲线模块
.\modular_build.ps1 -Modules HGSearchModule,HGCurveModule

# 编译所有模块并清理构建目录
.\modular_build.ps1 -Modules all -Clean

# 编译特定模块并使用8个并行任务
.\modular_build.ps1 -Modules HGPrintModule,HGUartModule -Jobs 8

# 使用Debug模式编译
.\modular_build.ps1 -Modules HGSearchModule -Debug

# 列出所有可用模块
.\modular_build.ps1 -ListModules

# 查看帮助信息
.\modular_build.ps1 -Help
```

## 可用模块列表

### 基础模块（默认包含）
- `HGBaseAppModule` - 基础应用模块
- `pluginInterface` - 插件接口模块
- `HGSharedFileModule` - 共享文件模块
- `HGAnalysisRecordModule` - 分析记录模块

### 功能模块
- `HGSearchModule` - 搜索模块
- `HGCurveModule` - 曲线模块
- `HGPrintModule` - 打印模块
- `HGUartModule` - 串口模块
- `HGEBalanceModule` - 电子天平模块
- `HGLoginModule` - 登录模块
- `HGLogModule` - 日志模块
- `HGExceptionHandleModule` - 异常处理模块
- `HGScannerModule` - 扫描仪模块
- `HGCameraRecognizeModule` - 摄像头识别模块
- `HGMethodModule` - 方法模块
- `HGTaskModule` - 任务模块
- `HGFlowModule` - 流程模块
- `HGChannelModule` - 通道模块
- `HGReagentModule` - 试剂模块
- `HGUserAuditModule` - 用户审计模块

## 编译选项

### 并行任务数
- 脚本会自动检测CPU核心数
- 默认使用检测到的核心数（最大8个）
- 可以通过 `--jobs N` 或 `-Jobs N` 手动设置

### 编译模式
- `Release` - 发布模式（默认）
- `Debug` - 调试模式（使用 `--debug` 或 `-Debug`）

### 清理构建
- 使用 `--clean` 或 `-Clean` 清理构建目录

## 技术实现

### CMake配置

模块化编译通过以下CMake变量实现：

```cmake
# 启用模块化编译
option(MODULAR_BUILD_ENABLED "启用模块化编译" OFF)

# 要编译的模块列表（空格分隔）
set(BUILD_MODULES "" CACHE STRING "要编译的模块列表（空格分隔）")
```

### 编译流程

1. **参数解析** - 解析命令行参数，确定要编译的模块
2. **目录准备** - 清理或创建构建目录
3. **CMake配置** - 生成包含模块选择信息的CMake配置
4. **并行编译** - 使用指定的并行任务数进行编译
5. **结果统计** - 显示编译结果和生成的文件

## 使用场景

### 开发特定功能
当您只修改了某个模块的代码时，可以只编译该模块：

```cmd
# 只编译搜索模块
modular_build.bat HGSearchModule
```

### 快速验证
在集成测试前，可以只编译相关模块进行快速验证：

```cmd
# 编译数据相关模块
modular_build.bat HGSearchModule HGCurveModule HGAnalysisRecordModule
```

### 调试特定问题
当需要调试某个模块时，使用Debug模式：

```cmd
# 使用Debug模式编译串口模块
modular_build.bat HGUartModule --debug
```

## 性能优势

- **编译时间减少**：只编译需要的模块，编译时间可减少50-80%
- **资源利用优化**：自动检测CPU核心数，充分利用系统资源
- **增量编译**：模块化编译支持增量编译，进一步减少编译时间

## 注意事项

1. **模块依赖**：确保编译的模块包含其所有依赖项
2. **基础模块**：基础模块（HGBaseAppModule、pluginInterface等）默认包含
3. **并行任务**：过多的并行任务可能导致内存不足，建议根据系统配置调整
4. **构建目录**：模块化编译使用相同的构建目录，清理构建目录会影响所有模块

## 故障排除

### 模块不存在错误
如果指定了不存在的模块，脚本会显示警告并忽略该模块。

### 编译失败
检查模块的依赖关系，确保所有必需的模块都已包含在编译列表中。

### 内存不足
减少并行任务数（使用 `--jobs 2` 或更少）。

## 扩展功能

### 自定义模块组
您可以创建自定义的模块组配置文件：

```cmd
# 创建数据模块组
modular_build.bat HGSearchModule HGCurveModule HGAnalysisRecordModule

# 创建硬件模块组  
modular_build.bat HGUartModule HGEBalanceModule HGScannerModule
```

### 集成到开发流程
可以将模块化编译集成到您的CI/CD流程中，只编译变更的模块。

---

通过模块化编译，您可以显著提高开发效率，减少不必要的编译等待时间。